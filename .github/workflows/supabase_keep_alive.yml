name: Supabase Keep-Alive

on:
  schedule:
    # 3日ごとの午前0時 (UTC) に実行
    # 7日間のスリープ制限を回避するために十分な間隔です
    - cron: '0 0 */3 * *'

  workflow_dispatch:
    # Actionsタブから手動で実行するためにも使えます

jobs:
  ping-supabase:
    runs-on: ubuntu-latest
    steps:
      - name: Ping Supabase Database
        run: |

          # curlを使ってAPIにリクエストを送信し、HTTPステータスコードを取得
          # -s: サイレントモード (進捗非表示)
          # -o /dev/null: レスポンスボディは捨てる (不要なため)
          # -w "%{http_code}": ステータスコードだけを出力する
          http_status=$(curl -s -o /dev/null -w "%{http_code}" \
            "${{ secrets.SUPABASE_URL }}/rest/v1/${TABLE_TO_CHECK}?select=*&limit=1" \
            -H "apikey: ${{ secrets.SUPABASE_API_KEY }}" \
            -H "Authorization: Bearer ${{ secrets.SUPABASE_API_KEY }}")